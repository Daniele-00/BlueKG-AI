[
    {
        "id": "TEST-107-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Quali sono i 5 articoli con il margine di profitto percentuale più alto?",
        "output": "MATCH (a:Articolo)<-[:RIGUARDA_ARTICOLO]-(dr_acq:RigaDocumento)<-[:CONTIENE_RIGA]-(:Documento)<-[:HA_EMESSO]-(:Fornitore) WITH a, sum(dr_acq.importo) AS costoTotale MATCH (a)<-[:RIGUARDA_ARTICOLO]-(dr_ven:RigaDocumento)<-[:CONTIENE_RIGA]-(:Documento)<-[:HA_RICEVUTO]-(:Cliente) WHERE dr_ven.tipoValore = 'Fatturato' AND dr_ven.importo > 0 WITH a, costoTotale, sum(dr_ven.importo) AS fatturatoTotale WHERE costoTotale > 0 RETURN a.descrizione AS prodotto, ((fatturatoTotale - costoTotale) * 100.0 / costoTotale) AS marginePercentuale ORDER BY marginePercentuale DESC LIMIT 5"
    },
    {
        "id": "TEST-108-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Mostrami la crescita del fatturato mese su mese per il 2024",
        "output": "MATCH (:Cliente)-[:HA_RICEVUTO]->(doc:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 AND doc.dataEmissione.year = 2024 WITH doc.dataEmissione.month AS mese, sum(dr.importo) AS fatturatoMensile ORDER BY mese WITH collect({mese: mese, fatturato: fatturatoMensile}) AS datiMensili UNWIND range(0, size(datiMensili)-2) AS i RETURN datiMensili[i].mese AS mese, datiMensili[i].fatturato AS fatturatoCorrente, datiMensili[i+1].fatturato AS fatturatoPrecedente, ((datiMensili[i].fatturato - datiMensili[i+1].fatturato) * 100.0 / datiMensili[i+1].fatturato) AS crescitaPercentuale"
    },
    {
        "id": "TEST-109-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Dammi 10 clienti hanno ridotto il loro fatturato di almeno il 20% rispetto all'anno precedente?",
        "output": "MATCH (c:Cliente)-[:HA_RICEVUTO]->(doc:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 AND doc.dataEmissione.year IN [date().year - 1, date().year - 2] WITH c, doc.dataEmissione.year AS anno, sum(dr.importo) AS fatturatoAnnuale WITH c, collect({anno: anno, fatturato: fatturatoAnnuale}) AS fatturatiAnni WHERE size(fatturatiAnni) = 2 WITH c, fatturatiAnni[0].fatturato AS annoCorrente, fatturatiAnni[1].fatturato AS annoPrecedente WHERE annoPrecedente > 0 AND ((annoPrecedente - annoCorrente) * 100.0 / annoPrecedente) >= 20 RETURN c.name AS cliente, annoPrecedente AS fatturatoAnnoPrec, annoCorrente AS fatturatoAnnoCorr, ((annoPrecedente - annoCorrente) * 100.0 / annoPrecedente) AS calosPercentuale ORDER BY calosPercentuale DESC LIMIT 10"
    },
    {
        "id": "TEST-110-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Trova 10 prodotti che sono stati acquistati da almeno 3 fornitori diversi",
        "output": "MATCH (a:Articolo)<-[:RIGUARDA_ARTICOLO]-(:RigaDocumento)<-[:CONTIENE_RIGA]-(:Documento)<-[:HA_EMESSO]-(:Fornitore)-[:RAGGRUPPATO_SOTTO]->(gf:GruppoFornitore) WITH a, count(DISTINCT gf) AS numeroFornitori WHERE numeroFornitori >= 3 RETURN a.descrizione AS prodotto, numeroFornitori ORDER BY numeroFornitori DESC LIMIT 10"
    },
    {
        "id": "TEST-111-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Qual è il tempo medio tra l'emissione di un ordine cliente e la relativa fattura?",
        "output": "MATCH (c:Cliente)-[:HA_RICEVUTO]->(docOrd:Documento)-[:IS_TYPE]->(dtOrd:DocType {codice: 'OC'}) MATCH (c)-[:HA_RICEVUTO]->(docFat:Documento)-[:IS_TYPE]->(dtFat:DocType {codice: 'FVC'}) WHERE docFat.dataEmissione > docOrd.dataEmissione AND duration.between(docOrd.dataEmissione, docFat.dataEmissione).days <= 90 RETURN avg(duration.between(docOrd.dataEmissione, docFat.dataEmissione).days) AS giorniMedi"
    },
    {
        "id": "TEST-112-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Elenca le sottofamiglie che non hanno avuto vendite negli ultimi 6 mesi",
        "output": "MATCH (sf:Sottofamiglia) WHERE NOT EXISTS { MATCH (sf)<-[:APPARTIENE_A]-(:Articolo)<-[:RIGUARDA_ARTICOLO]-(:RigaDocumento {tipoValore: 'Fatturato'})<-[:CONTIENE_RIGA]-(doc:Documento) WHERE doc.dataEmissione >= date() - duration({months: 6}) } RETURN sf.nome AS sottofamigliaSenzaVendite ORDER BY sottofamigliaSenzaVendite"
    },
    {
        "id": "TEST-113-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Qual è la concentrazione del fatturato? (percentuale generata dai top 10 clienti)",
        "output": "MATCH (c:Cliente)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 WITH sum(dr.importo) AS fatturatoTotale MATCH (c:Cliente)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 WITH c, sum(dr.importo) AS fatturatoCliente, fatturatoTotale ORDER BY fatturatoCliente DESC LIMIT 10 RETURN (sum(fatturatoCliente) * 100.0 / fatturatoTotale) AS concentrazioneTop10"
    },
    {
        "id": "TEST-114-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Mostrami 10 clienti che acquistano solo prodotti di una singola famiglia",
        "output": "MATCH (c:Cliente)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(:RigaDocumento)-[:RIGUARDA_ARTICOLO]->(:Articolo)-[:APPARTIENE_A]->(:Sottofamiglia)-[:INCLUSA_IN]->(fam:Famiglia) WITH c, count(DISTINCT fam) AS numeroFamiglie WHERE numeroFamiglie = 1 MATCH (c)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(:RigaDocumento)-[:RIGUARDA_ARTICOLO]->(:Articolo)-[:APPARTIENE_A]->(:Sottofamiglia)-[:INCLUSA_IN]->(fam:Famiglia) RETURN c.name AS cliente, collect(DISTINCT fam.nome)[0] AS famigliaUnica LIMIT 10"
    },
    {
        "id": "TEST-115-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Qual è il tasso di conversione da ordini a fatture per valore?",
        "output": "MATCH (:Cliente)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore IN ['Ordinato', 'Fatturato'] WITH sum(CASE WHEN dr.tipoValore = 'Ordinato' THEN dr.importo ELSE 0 END) AS totaleOrdinato, sum(CASE WHEN dr.tipoValore = 'Fatturato' THEN dr.importo ELSE 0 END) AS totaleFatturato WHERE totaleOrdinato > 0 RETURN (totaleFatturato * 100.0 / totaleOrdinato) AS tassoConversionePercentuale"
    },
    {
        "id": "TEST-116-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Quali sono i 3 giorni della settimana con più fatturato nel 2024?",
        "output": "MATCH (:Cliente)-[:HA_RICEVUTO]->(doc:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 AND doc.dataEmissione.year = 2024 WITH doc.dataEmissione.dayOfWeek AS giornoSettimana, sum(dr.importo) AS fatturatoGiorno RETURN giornoSettimana, fatturatoGiorno ORDER BY fatturatoGiorno DESC LIMIT 3"
    },
    {
        "id": "TEST-117-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Trova 10 prodotti con rotazione lenta (venduti meno di 5 volte in totale)",
        "output": "MATCH (a:Articolo)<-[:RIGUARDA_ARTICOLO]-(dr:RigaDocumento)<-[:CONTIENE_RIGA]-(doc:Documento)<-[:HA_RICEVUTO]-(:Cliente) WHERE dr.tipoValore = 'Fatturato' WITH a, count(DISTINCT doc) AS numeroVendite WHERE numeroVendite < 5 RETURN a.descrizione AS prodottoRotazioneLenta, numeroVendite ORDER BY numeroVendite ASC LIMIT 10"
    },
    {
        "id": "TEST-120-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Qual è la stagionalità delle vendite? Mostra il fatturato per trimestre negli ultimi 2 anni",
        "output": "MATCH (:Cliente)-[:HA_RICEVUTO]->(doc:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 AND doc.dataEmissione.year >= date().year - 2 WITH doc.dataEmissione.year AS anno, CASE WHEN doc.dataEmissione.month <= 3 THEN 'Q1' WHEN doc.dataEmissione.month <= 6 THEN 'Q2' WHEN doc.dataEmissione.month <= 9 THEN 'Q3' ELSE 'Q4' END AS trimestre, sum(dr.importo) AS fatturatoTrimestrale RETURN anno, trimestre, fatturatoTrimestrale ORDER BY anno DESC, trimestre"
    },
    {
        "id": "TEST-121-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Trova i clienti che hanno acquistato tutti i prodotti di una specifica famiglia",
        "output": "MATCH (fam:Famiglia {nome: 'CENTRALI FRIGO'})<-[:INCLUSA_IN]-(:Sottofamiglia)<-[:APPARTIENE_A]-(a:Articolo) WITH collect(DISTINCT a) AS tuttiArticoliFamiglia, count(DISTINCT a) AS totaleArticoliFamiglia MATCH (c:Cliente)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(:RigaDocumento)-[:RIGUARDA_ARTICOLO]->(a:Articolo) WHERE a IN tuttiArticoliFamiglia WITH c, count(DISTINCT a) AS articoliAcquistati, totaleArticoliFamiglia WHERE articoliAcquistati = totaleArticoliFamiglia RETURN c.name AS clienteCompletista"
    },
    {
        "id": "TEST-122-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Qual è la distribuzione geografica del fatturato per regione?",
        "output": "MATCH (c:Cliente)-[:HAS_ADDRESS]->(l:Luogo) MATCH (c)-[:HA_RICEVUTO]->(:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 AND l.regione IS NOT NULL WITH l.regione AS regione, sum(dr.importo) AS fatturatoRegionale, sum(dr.importo) AS totaleVendite WITH regione, fatturatoRegionale, sum(totaleVendite) AS fatturatoTotaleGlobale RETURN regione, fatturatoRegionale, (fatturatoRegionale * 100.0 / fatturatoTotaleGlobale) AS percentualeFatturato ORDER BY fatturatoRegionale DESC"
    },
    {
        "id": "TEST-123-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Mostrami 10 prodotti che hanno avuto un incremento di vendita superiore al 50% nell'ultimo anno",
        "output": "MATCH (a:Articolo)<-[:RIGUARDA_ARTICOLO]-(dr:RigaDocumento)<-[:CONTIENE_RIGA]-(doc:Documento) WHERE dr.tipoValore = 'Fatturato' AND dr.importo > 0 AND doc.dataEmissione.year IN [date().year - 1, date().year - 2] WITH a, doc.dataEmissione.year AS anno, sum(dr.importo) AS venditeAnnuali WITH a, collect({anno: anno, vendite: venditeAnnuali}) AS venditePerAnno WHERE size(venditePerAnno) = 2 WITH a, venditePerAnno[0].vendite AS venditaAnnoPrec, venditePerAnno[1].vendite AS venditaAnnoCorr WHERE venditaAnnoPrec > 0 AND ((venditaAnnoCorr - venditaAnnoPrec) * 100.0 / venditaAnnoPrec) > 50 RETURN a.descrizione AS prodotto, ((venditaAnnoCorr - venditaAnnoPrec) * 100.0 / venditaAnnoPrec) AS crescitaPercentuale ORDER BY crescitaPercentuale DESC LIMIT 10"
    },
    {
        "id": "TEST-124-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Quali fornitori hanno avuto il miglior rapporto qualità-prezzo (minor costo medio per articolo)?",
        "output": "MATCH (gf:GruppoFornitore)<-[:RAGGRUPPATO_SOTTO]-(:Fornitore)-[:HA_EMESSO]->(:Documento)-[:CONTIENE_RIGA]->(dr:RigaDocumento) WHERE dr.quantita > 0 WITH gf, avg(dr.importo / dr.quantita) AS costoMedioUnitario RETURN gf.ragioneSociale AS fornitore, costoMedioUnitario ORDER BY costoMedioUnitario ASC LIMIT 5"
    },
    {
        "id": "TEST-126-Genera la query Cypher per rispondere a questo input in italiano",
        "input": "Qual è il prodotto con il ciclo di riordino più breve (tempo medio tra acquisti successivi)?",
        "output": "MATCH (a:Articolo)<-[:RIGUARDA_ARTICOLO]-(:RigaDocumento)<-[:CONTIENE_RIGA]-(doc:Documento)<-[:HA_EMESSO]-(:Fornitore) WITH a, doc.dataEmissione AS dataAcquisto ORDER BY a, dataAcquisto WITH a, collect(dataAcquisto) AS dateAcquisti WHERE size(dateAcquisti) >= 3 UNWIND range(0, size(dateAcquisti)-2) AS i WITH a, duration.between(dateAcquisti[i], dateAcquisti[i+1]).days AS giorniTraAcquisti WHERE giorniTraAcquisti > 0 WITH a, avg(giorniTraAcquisti) AS cicloMedioRiordino RETURN a.descrizione AS prodotto, cicloMedioRiordino ORDER BY cicloMedioRiordino ASC LIMIT 1"
    }
]